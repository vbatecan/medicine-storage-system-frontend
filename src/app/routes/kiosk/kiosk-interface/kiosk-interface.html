<p-toast></p-toast>
<div class="kiosk-container">
  <!-- Header with authentication status -->
  <header class="kiosk-header">
    <div class="auth-status">
      <div class="auth-indicator" [ngClass]="{'authenticated': isAuthenticated(), 'pending': isAuthenticating()}">
        <i class="icon" [ngClass]="getAuthIcon()"></i>
        <span class="status-text">{{ getAuthStatusText() }}</span>
      </div>
      <div class="user-info" *ngIf="authenticatedUser">
        <span class="welcome-text">Welcome, {{ authenticatedUser.name }}</span>
      </div>
    </div>
    <div class="system-title">
      <h1>Medicine Storage System</h1>
    </div>
  </header>

  <!-- Main content area -->
  <main class="kiosk-main">
    <!-- Camera feed section -->
    <section class="camera-section">
      <div class="camera-container">
        <video #videoElement class="camera-feed" autoplay muted playsinline></video>

        <!-- Face detection bounding box overlay -->
        <div class="bounding-box face-box"
             *ngIf="faceDetection"
             [style.left.px]="faceDetection.x"
             [style.top.px]="faceDetection.y"
             [style.width.px]="faceDetection.width"
             [style.height.px]="faceDetection.height">
          <span class="detection-label">{{ faceDetection.identity || 'Detecting...' }}</span>
        </div>

        <!-- Medicine detection bounding boxes overlay -->
        <div class="bounding-box medicine-box"
             *ngFor="let medicine of medicineDetections"
             [style.left.px]="medicine.bbox.x"
             [style.top.px]="medicine.bbox.y"
             [style.width.px]="medicine.bbox.width"
             [style.height.px]="medicine.bbox.height">
          <span class="detection-label">{{ medicine.name }}</span>
        </div>
      </div>

      <!-- Camera status indicators -->
      <div class="camera-status">
        <div class="status-item">
          <span class="status-label">Camera:</span>
          <span class="status-value" [ngClass]="{'active': isCameraActive, 'inactive': !isCameraActive}">
            {{ isCameraActive ? 'Active' : 'Inactive' }}
          </span>
        </div>
        <div class="status-item">
          <span class="status-label">Processing:</span>
          <span class="status-value" [ngClass]="{'processing': isProcessing}">
            {{ isProcessing ? 'Processing...' : 'Ready' }}
          </span>
        </div>
      </div>
    </section>

    <!-- Instructions panel -->
    <section class="instructions-section">
      <div class="instruction-card" *ngIf="!isAuthenticated()">
        <h3>Step 1: Face Authentication</h3>
        <p>Please position your face in front of the camera for authentication.</p>
        <ul>
          <li>Look directly at the camera</li>
          <li>Ensure good lighting</li>
          <li>Wait for recognition</li>
        </ul>
      </div>

      <div class="instruction-card" *ngIf="isAuthenticated() && currentMode === 'medicine'">
        <h3>Step 2: Medicine Detection</h3>
        <p>Hold the medicine package in front of the camera for identification.</p>
        <ul>
          <li>Hold the medicine clearly visible</li>
          <li>Ensure the label is readable</li>
          <li>Wait for classification</li>
        </ul>
      </div>
    </section>

    <!-- Medicine detection results -->
    <section class="results-section" *ngIf="isAuthenticated()">
      <h3>Detection Results</h3>
      <div class="medicine-results" *ngIf="medicineDetections.length > 0; else noDetections">
        <div class="medicine-item" *ngFor="let medicine of medicineDetections">
          <div class="medicine-info">
            <h4>{{ medicine.name }}</h4>
            <p class="medicine-details">{{ medicine.details }}</p>
            <div class="confidence-scores">
              <span class="confidence detection">Detection: {{ (medicine.confidence * 100).toFixed(1) }}%</span>
              <span class="confidence classification">Classification: {{ (medicine.classifyConfidence * 100).toFixed(1) }}%</span>
            </div>
          </div>
          <div class="medicine-actions">
            <button class="btn-primary" (click)="dispenseMedicine(medicine)">
              Dispense
            </button>
          </div>
        </div>
      </div>
      <ng-template #noDetections>
        <p class="no-results">No medicine detected. Please hold a medicine package in front of the camera.</p>
      </ng-template>
    </section>
  </main>

  <!-- Footer with system status -->
  <footer class="kiosk-footer">
    <div class="system-status">
      <span class="status-indicator" [ngClass]="{'online': isSystemOnline, 'offline': !isSystemOnline}"></span>
      <span>System Status: {{ isSystemOnline ? 'Online' : 'Offline' }}</span>
    </div>
    <div class="last-updated">
      Last updated: {{ lastUpdateTime | date:'short' }}
    </div>
  </footer>
</div>
